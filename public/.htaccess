# sichergehen, dass benötigte Module aktiv sind 
<IfModule mod_headers.c>
</IfModule>
<IfModule mod_expires.c>
    ExpiresActive On
</IfModule>

# 404-Seite (Astro buildt /404.html)
ErrorDocument 404 /404.html

# HTML nie aus dem Cache zeigen
<IfModule mod_headers.c>
  <FilesMatch "\.(?:html?)$">
    Header set Cache-Control "no-store, no-cache, must-revalidate, max-age=0"
    Header set Pragma "no-cache"
  </FilesMatch>
</IfModule>

# JSON (Stats-Daten) kurz cachen + revalidieren
<IfModule mod_headers.c>
  <FilesMatch "\.(?:json)$">
    # Kurzzeit-Cache + schnelle Revalidierung
    Header set Cache-Control "max-age=300, must-revalidate, stale-while-revalidate=86400"
  </FilesMatch>
</IfModule>

#Caching
<IfModule mod_headers.c>
  # HTML: häufig aktualisiert
  <FilesMatch "\.(?:html)$">
    Header set Cache-Control "no-cache"
  </FilesMatch>

  # CSS/JS: kurz bis mittel
  <FilesMatch "\.(?:css|js|mjs)$">
    Header set Cache-Control "public, max-age=3600"
  </FilesMatch>

  # Fonts/Bilder: etwas länger
  <FilesMatch "\.(?:woff2?|ttf|eot|gif|png|jpg|jpeg|webp|svg)$">
    Header set Cache-Control "public, max-age=604800"
  </FilesMatch>
</IfModule>

# Kompression aktivieren
<IfModule mod_deflate.c>
    # Text, HTML, JavaScript, CSS, XML und JSON komprimieren
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE application/json
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml

    # Bilder und andere bereits komprimierte Inhalte ausschließen
    SetEnvIfNoCase Request_URI \.(?:gif|jpe?g|png|zip|gz|bz2|woff2|ico|pdf|mp4|mp3)$ no-gzip dont-vary

    # Browser-Kompatibilität sicherstellen
    Header append Vary Accept-Encoding
</IfModule>