---
import { ROLE_COLORS, ROLE_LABELS, type RoleKey } from '../../data/roles';

export interface Props {
  role: RoleKey;
  class?: string;
}

const { role, class: className = '' } = Astro.props as Props;

const color = ROLE_COLORS[role];
const label = ROLE_LABELS[role];

function hexToRgba(hex: string, alpha: number) {
  const cleaned = hex.replace('#', '').trim();
  const full =
    cleaned.length === 3
      ? cleaned
          .split('')
          .map((c) => c + c)
          .join('')
      : cleaned;
  const r = parseInt(full.slice(0, 2), 16);
  const g = parseInt(full.slice(2, 4), 16);
  const b = parseInt(full.slice(4, 6), 16);
  return `rgba(${r}, ${g}, ${b}, ${alpha})`;
}

// Subtle tint only for the dot halo (keeps the chip itself aligned with v2 glass design).
const halo = hexToRgba(color, 0.22);
---

<span
  class={`inline-flex items-center gap-2 rounded-full border border-border bg-surface px-2.5 py-1 text-xs font-medium text-fg backdrop-blur-md ${className}`.trim()}
>
  <span class="relative inline-flex h-2.5 w-2.5 items-center justify-center" aria-hidden="true">
    <span class="absolute inset-0 rounded-full" style={`background: ${halo};`}></span>
    <span class="h-1.5 w-1.5 rounded-full" style={`background: ${color};`}></span>
  </span>
  <span class="leading-none">{label}</span>
</span>
