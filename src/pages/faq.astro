---
import BaseLayout from '../layouts/BaseLayout.astro';
import Card from '../components/ui/Card.astro';
import Button from '../components/ui/Button.astro';
import JsonLd from '../components/seo/JsonLd.astro';
import { buildFaqPage } from '../lib/structuredData';
import { ArrowRight, BookOpen, Hammer, Shield, Cpu, Users, ScrollText } from '@lucide/astro';
import { getEntry } from 'astro:content';
import { renderMarkdown } from '../utils/renderMarkdown';

type FaqItem = { q: string; a: string };

type FaqGroupJson = {
  title: string;
  icon: 'BookOpen' | 'Hammer' | 'Shield' | 'Cpu';
  items: FaqItem[];
};
const ICONS = { BookOpen, Hammer, Shield, Cpu } as const;

const faqEntry = await getEntry('faq', 'main');
if (!faqEntry) {
  throw new Error('FAQ-Content (src/content/faq/main.json) konnte nicht geladen werden.');
}

const groups = (faqEntry.data as FaqGroupJson[]).map((g) => ({
  ...g,
  icon: ICONS[g.icon],
}));

const site = new URL('https://minecraft-gilde.de');
const canonicalUrl = 'https://minecraft-gilde.de/faq/';
const faqLd = buildFaqPage({
  site,
  canonicalUrl,
  items: groups.flatMap((g) => g.items),
});
---

<BaseLayout
  title="Minecraft Gilde - FAQ"
  canonical="https://minecraft-gilde.de/faq/"
  description="FAQ zur Minecraft Gilde: Erststart, Grundstücke, Updates, PvP, Technik & Community – übersichtlich gruppiert."
>
  <JsonLd slot="head" data={faqLd} />
  <section class="mg-container pt-12 pb-8">
    <h1 class="text-3xl font-semibold tracking-tight">FAQ</h1>
    <p class="text-muted mt-2 max-w-3xl">
      Häufige Fragen – kurz, klar und übersichtlich. Wenn etwas fehlt: schreib uns gerne auf
      Discord.
    </p>

    <div class="mt-6 flex flex-wrap gap-2">
      <Button href="/tutorial" variant="secondary" size="sm" class="gap-2">
        <BookOpen size={16} /> Tutorial
      </Button>
      <Button href="/regeln" variant="ghost" size="sm" class="gap-2">
        <Shield size={16} /> Regeln
      </Button>
      <Button href="/voten" variant="ghost" size="sm" class="gap-2">
        <ArrowRight size={16} /> Voten
      </Button>
    </div>
  </section>

  <section class="mg-container pb-16">
    <div class="grid gap-4">
      {
        groups.map((g) => (
          <Card class="p-6">
            <div class="flex items-start gap-4">
              <div class="border-border/70 bg-accent/10 text-accent mt-0.5 flex h-12 w-12 shrink-0 items-center justify-center rounded-xl border">
                <g.icon class="h-7 w-7" />
              </div>

              <div class="min-w-0 flex-1">
                <h2 class="text-lg font-semibold tracking-tight">{g.title}</h2>

                <div class="mt-4 grid gap-2">
                  {g.items.map((it) => (
                    <details class="border-border bg-surface/55 rounded-[var(--radius)] border px-4 py-3">
                      <summary class="cursor-pointer list-none text-sm font-semibold outline-none">
                        <span class="inline-flex items-center gap-2">
                          <span
                            class="bg-accent mt-0.5 h-2 w-2 flex-none rounded-full"
                            aria-hidden="true"
                          />
                          {it.q}
                        </span>
                      </summary>
                      <div
                        class="faq-answer mg-prose mt-3 text-sm leading-relaxed"
                        set:html={renderMarkdown(it.a)}
                      />
                    </details>
                  ))}
                </div>
              </div>
            </div>
          </Card>
        ))
      }
    </div>

    <div class="mt-8">
      <Card class="p-6">
        <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
          <div class="min-w-0">
            <h2 class="text-lg font-semibold tracking-tight">Noch Fragen?</h2>
            <p class="text-muted mt-2 text-sm">
              Auf Discord findest du Updates, Hilfe und die Community.
            </p>
          </div>
          <div class="flex gap-2">
            <Button href="/serverinfos" variant="secondary" size="sm" class="gap-2">
              <ScrollText size={16} /> Serverinfos
            </Button>
            <Button
              href="https://discord.minecraft-gilde.de"
              external
              variant="primary"
              size="sm"
              class="gap-2"
            >
              <Users size={16} /> Discord <ArrowRight size={16} />
            </Button>
          </div>
        </div>
      </Card>
    </div>
  </section>

  <style is:global>
    /*
      FAQ nutzt die gleichen "mg-prose" Link-Styles wie der Rest der Seite.
      Hier halten wir nur den Abstand im Accordion kompakt.
    */
    .faq-answer.mg-prose > :first-child {
      margin-top: 0;
    }

    .faq-answer.mg-prose > :last-child {
      margin-bottom: 0;
    }
  </style>
</BaseLayout>
