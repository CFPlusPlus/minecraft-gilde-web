---
import BaseLayout from '../layouts/BaseLayout.astro';
import Card from '../components/ui/Card.astro';
import Button from '../components/ui/Button.astro';
import { getEntry } from 'astro:content';
import { Search, TerminalSquare, Copy } from '@lucide/astro';

const commandsEntry = await getEntry('commands', 'list');
if (!commandsEntry) throw new Error('Missing commands content: src/content/commands/list.json');

const categories = commandsEntry.data.categories;
---

<BaseLayout
  title="Minecraft Gilde - Server-Befehle"
  canonical="https://minecraft-gilde.de/befehle/"
>
  <section class="mg-container pt-12 pb-6">
    <h1 class="text-3xl font-semibold tracking-tight">Befehle</h1>
    <p class="text-muted mt-2">
      Hier findest du alle Befehle die auf unserem Server verfügbar sind.
    </p>

    <div class="mt-6 flex flex-wrap gap-3">
      <Button variant="primary" class="gap-2" data-copy-ip>
        <Copy size={18} /> IP kopieren
      </Button>
      <Button href="/regeln" variant="secondary">Regeln</Button>
      <Button href="/tutorial" variant="ghost">Tutorial</Button>
    </div>
  </section>

  <section class="mg-container pb-16" data-commands>
    <Card class="p-4">
      <div class="flex items-center gap-3">
        <Search size={18} />
        <input
          id="commandSearch"
          type="search"
          placeholder="Suchen (z. B. /rtp, claim, home …)"
          class="border-border bg-surface h-10 w-full rounded-lg border px-3 text-sm outline-none focus:ring-2 focus:ring-[color:var(--ring)]"
          autocomplete="off"
        />
      </div>
    </Card>

    <div class="mt-4 space-y-3">
      {
        categories.map((cat) => (
          <details class="mg-accordion" open data-category>
            <summary class="flex items-center justify-between gap-3">
              <div class="inline-flex items-center gap-2">
                <TerminalSquare size={18} />
                <span class="text-sm font-semibold">{cat.name}</span>
              </div>
              <span class="text-muted text-xs">{cat.commands.length} Befehle</span>
            </summary>

            <div class="mt-3 grid gap-2">
              {cat.commands.map((cmd) => (
                <div
                  class="border-border bg-surface rounded-lg border px-4 py-3"
                  data-command
                  data-search={`${cmd.command} ${cmd.description}`}
                >
                  <div class="flex flex-col gap-1 sm:flex-row sm:items-start sm:justify-between">
                    <code class="text-fg font-mono text-sm">{cmd.command}</code>
                    <p class="text-muted text-sm">{cmd.description}</p>
                  </div>
                </div>
              ))}
            </div>
          </details>
        ))
      }
    </div>
  </section>

  <script slot="afterScripts" src="/js/app-commands.js" defer></script>
</BaseLayout>
