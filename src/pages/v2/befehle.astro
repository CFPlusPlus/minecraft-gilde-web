---
import V2Layout from '../../layouts/V2Layout.astro';
import Card from '../../components/v2/ui/Card.astro';
import Button from '../../components/v2/ui/Button.astro';
import { getEntry } from 'astro:content';
import { Search, TerminalSquare, Copy } from '@lucide/astro';

const commandsEntry = await getEntry('commands', 'main');
if (!commandsEntry) throw new Error('Commands entry "main" not found');

const categories = commandsEntry.data.categories;
---

<V2Layout
  title="Minecraft Gilde – Befehle (v2)"
  canonical="https://minecraft-gilde.de/v2/befehle"
  description="Wichtige Befehle für Minecraft Gilde – übersichtlich, durchsuchbar."
>
  <section class="v2-container pt-12 pb-6">
    <h1 class="text-3xl font-semibold tracking-tight">Befehle</h1>
    <p class="text-muted mt-2">Schnell finden, was du brauchst. Kategorien sind aufklappbar.</p>

    <div class="mt-6 flex flex-wrap gap-3">
      <Button variant="primary" class="gap-2" data-copy-ip>
        <Copy size={18} /> IP kopieren
      </Button>
      <Button href="/v2/rules" variant="secondary">Regeln</Button>
      <Button href="/v2/erststart" variant="ghost">Erststart</Button>
    </div>
  </section>

  <section class="v2-container pb-16" data-v2-commands>
    <Card class="p-4">
      <div class="flex items-center gap-3">
        <Search size={18} />
        <input
          id="v2CommandSearch"
          type="search"
          placeholder="Suchen (z. B. /rtp, claim, home …)"
          class="border-border bg-surface h-10 w-full rounded-lg border px-3 text-sm outline-none focus:ring-2 focus:ring-[color:var(--ring)]"
          autocomplete="off"
        />
      </div>
    </Card>

    <div class="mt-4 space-y-3">
      {
        categories.map((cat) => (
          <details class="v2-accordion" open data-v2-category>
            <summary class="flex items-center justify-between gap-3">
              <div class="inline-flex items-center gap-2">
                <TerminalSquare size={18} />
                <span class="text-sm font-semibold">{cat.name}</span>
              </div>
              <span class="text-muted text-xs">{cat.commands.length} Befehle</span>
            </summary>

            <div class="mt-3 grid gap-2">
              {cat.commands.map((cmd) => (
                <div
                  class="border-border bg-surface rounded-lg border px-4 py-3"
                  data-v2-command
                  data-search={`${cmd.command} ${cmd.description}`}
                >
                  <div class="flex flex-col gap-1 sm:flex-row sm:items-start sm:justify-between">
                    <code class="text-fg font-mono text-sm">{cmd.command}</code>
                    <p class="text-muted text-sm">{cmd.description}</p>
                  </div>
                </div>
              ))}
            </div>
          </details>
        ))
      }
    </div>
  </section>

  <script slot="afterScripts" src="/js/v2-commands.js" defer></script>
</V2Layout>
